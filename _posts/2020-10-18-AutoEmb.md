---
layout:     post
title:      ã€è®ºæ–‡é˜…è¯»ç¬”è®°ã€‘AutoEmb
subtitle:   AutoEmb:Automated Embedding Dimensionality Search in Streaming Recommendations
date:       2020-10-18
author:     Siyuan Lou
header-img: img/post-bg-article.jpg
catalog: true
tags:
    - Embedding Search
    - AutoML
typora-root-url: "/Users/bytedance/Documents/myblog/swan815.github.io"
---

# Title

![image-20201018230443652](/../../../../../../../img/blog/2020-10-18-AutoEmb/image-20201018230443652.png)

# Background

æ·±åº¦å­¦ä¹ æ¨èç³»ç»Ÿï¼ˆDLRSsï¼‰çš„ç»“æ„é€šå¸¸ç”±ä¸‰å±‚Embedding Layerã€Hidden Layerå’ŒOutput Layerä¸‰å±‚ç»„æˆï¼Œåœ¨Embedding Layerä¸­å¯¹äºç”¨æˆ·å’Œç‰©å“çš„Embeddingç»´åº¦é€šå¸¸æ˜¯å›ºå®šçš„ï¼Œä½†ä½œè€…åœ¨å®éªŒä¸­å‘ç°ï¼Œä¸åŒç”¨æˆ·/ç‰©å“ä¸åŒçš„è¡¨ç¤ºç»´åº¦æ˜¯å¿…è¦çš„ã€‚å¦‚ä¸‹å›¾çš„å®éªŒç»“æœæ‰€ç¤ºï¼š

<img src="/../../../../../../../img/blog/2020-10-18-AutoEmb/image-20201018231503317.png" alt="image-20201018231503317" style="zoom:50%;" />

æœ‰å¦‚ä¸‹ç»“è®ºï¼š

+ éšç€popularityçš„å¢åŠ ï¼Œæ¨èæ¨¡å‹çš„è¡¨ç°åœ¨ä¸åŒçš„Embeddingç»´åº¦éƒ½æœ‰æé«˜ï¼Œä½†æ˜¯è¶Šå¤§çš„Embeddingç»´åº¦
å¾—åˆ°æ›´å¤šæ”¶ç›Šã€‚
+ åœ¨popularityæ¯”è¾ƒå°çš„æ—¶å€™ï¼ŒEmbeddingç»´åº¦æ¯”è¾ƒå°å°±å¯ä»¥å¾—åˆ°æœ€ä¼˜çš„ç»“æœï¼Œä½†æ˜¯ä¹‹åä¼šè¢«æ›´å¤§çš„Embeddingç»´åº¦è¶…è¶Š

æœ¬æ–‡æ®æ­¤æå‡ºæ ¹æ®popularityå’Œä¸Šä¸‹æ–‡ä¿¡æ¯æ¥é€‰æ‹©ç”¨æˆ·å’Œç‰©å“çš„Embeddingç»´åº¦çš„**AutoEmb**
# Problem Statement
å¯¹ä¸åŒç”¨æˆ·/ç‰©å“é€‰æ‹©ä¸åŒç»´åº¦å­˜åœ¨çš„ä¸¤ä¸ªé—®é¢˜ï¼š

+ å› ä¸ºéšå±‚çš„ç¬¬ä¸€å±‚ç»´åº¦å›ºå®šï¼Œä¸åŒçš„åµŒå…¥å±‚è¡¨ç¤ºç»´åº¦å¾ˆéš¾è¾“å…¥è¿›éšå±‚ï¼Œè¿›è¡Œè®­ç»ƒã€‚

+ å®é™…åœºæ™¯ä¸­ç”¨æˆ·/ç‰©å“æ•°ç›®å·¨å¤§ï¼Œæ‰‹å·¥é€‰æ‹©ç»´åº¦ä¸å¤ªå¯èƒ½ã€‚
# Method(s)
## 1. ä¸åŒç”¨æˆ·/ç‰©å“ç»´åº¦çš„ç»Ÿä¸€é—®é¢˜

ä½œè€…é€šè¿‡å¯¹Embeddingå˜æ¢ç»Ÿä¸€ç»´åº¦è¾“å…¥è¿›Hidden Layerã€‚å…·ä½“åšæ³•å¯ä»¥ä»ä¸‹å›¾æ‰€ç¤ºï¼š

<img src="/../../../../../../../img/blog/2020-10-18-AutoEmb/image-20201018231605856.png" alt="image-20201018231605856" style="zoom: 50%;" />

+ Embedding Lookup<img src="/../../../../../../../img/blog/2020-10-18-AutoEmb/image-20201113155638433.png" alt="image-20201113155638433" style="zoom:50%;" />è¡¨ç¤ºå°†ç”¨æˆ·$u_i$è¡¨ç¤ºæˆNä¸ªç»´åº¦ç©ºé—´

+ Linear Transformé€šè¿‡çº¿æ€§å˜æ¢å°†ç»´åº¦ç»Ÿä¸€ä¸º$d_N$

+ Activation BatchNormé€šè¿‡BNå’Œæ¿€æ´»å‡½æ•°å°†ç»´åº¦å˜æ¢ä¸ºåŒä¸€æ•°é‡çº§ï¼Œå¯æ¯”è¾ƒçš„

+ Hard Selectioné€šè¿‡maxå‡½æ•°è¿›è¡Œç»´åº¦é€‰æ‹©ï¼Œæ˜“çŸ¥maxå‡½æ•°æ˜¯ä¸å¯å¯¼çš„

## 2. Controllerç”¨äºé€‰æ‹©Embeddingçš„ç»´åº¦

æ ¹æ®popularityå’ŒEmbeddingç»´åº¦çš„å…³ç³»ï¼Œè®¾è®¡controllerã€‚è¾“å…¥ç”±ç”¨æˆ·/ç‰©å“çš„æµè¡Œåº¦å’Œä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆä¹‹å‰çš„å‚æ•°ã€å½“å‰ç”¨æˆ·å’Œç‰©å“çš„è®­ç»ƒæŸå¤±ï¼‰ç»„æˆï¼Œç»è¿‡ä¸­é—´çš„éšå±‚ï¼Œç­‰åˆ°æ¯ä¸ªEmbeddingè¡¨ç¤ºå¯èƒ½çš„æƒå€¼ã€‚

<img src="/../../../../../../../img/blog/2020-10-18-AutoEmb/image-20201113162933745.png" alt="image-20201113162933745" style="zoom:50%;" />

æœ€åç”¨æˆ·/ç‰©å“çš„è¡¨ç¤ºï¼š

<img src="/../../../../../../../img/blog/2020-10-18-AutoEmb/image-20201113163137392.png" alt="image-20201113163137392" style="zoom: 50%;" />

è¿™ç§åŠ æƒæ±‚å’Œçš„æ–¹å¼æ˜¯æ¨¡å‹å˜å¾—ç«¯åˆ°ç«¯å¯å¾®ï¼Œå¯ä»¥é€šè¿‡Dartsçš„æ–¹æ³•è¿›è¡Œä¼˜åŒ–ã€‚

## 3. AutoEmb

ä¸€ä¸ªåŠ å…¥AutoEmbçš„å¢å¼ºçš„æ¨èç³»ç»Ÿæ¨¡å‹ç»“æ„å¦‚å›¾ï¼Œå…ˆç»è¿‡Controllerè¿›è¡Œç»´åº¦é€‰æ‹©ï¼Œå°†ç”¨æˆ·å’Œç‰©å“çš„ç»´åº¦é€‰æ‹©æ‹¼æ¥ä¹‹åè¾“å…¥ä¹‹åçš„ä¸‰å±‚æ¨èç³»ç»Ÿæ¨¡å‹ã€‚

<img src="/../../../../../../../img/blog/2020-10-18-AutoEmb/image-20201113164805619.png" alt="image-20201113164805619" style="zoom:50%;" />

è¿™é‡Œçš„æ¨¡å‹å‚æ•°è‡ªç„¶å°±åŒ…æ‹¬äº†ä¸¤éƒ¨åˆ†ï¼ŒåŒ…æ‹¬äº†ä¸‰å±‚æ·±åº¦å­¦ä¹ æ¨èç³»ç»Ÿçš„æ¨¡å‹å‚æ•°$W$å’ŒControllerçš„å‚æ•°$\theta$ï¼Œè¿™é‡Œä½¿ç”¨åŸºäºDARTSçš„æ–¹æ³•è¿›è¡Œè”åˆè®­ç»ƒå’Œä¼˜åŒ–$\theta$ã€‚

ä½¿ç”¨æ¢¯åº¦ä¸‹é™çš„æ–¹æ³•ï¼Œç”¨training loss $ğ¿_{ğ‘¡ğ‘Ÿğ‘ğ‘–ğ‘›} \rightarrow W$ï¼Œvalidation loss$ ğ¿_{ğ‘£ğ‘ğ‘™} \rightarrow \theta$ï¼Œtraining losså’Œvalidation lossåŒæ—¶æœ‰DLRSsçš„å‚æ•°$ğ‘Š$å’ŒControllerçš„å‚æ•°$\theta$å†³å®šã€‚

<img src="/../../../../../../../img/blog/2020-10-18-AutoEmb/image-20201113165836433.png" alt="image-20201113165836433" style="zoom:50%;" />

+ Embeddingç»´åº¦æœç´¢ç›®æ ‡æ˜¯æ‰¾åˆ°æœ€ä¼˜çš„$Î¸^âˆ—$ é€šè¿‡æœ€å°åŒ–"validation loss"
+ DLRSçš„ç›®æ ‡æ˜¯è®­ç»ƒæ‰¾åˆ°$W^âˆ—$
+ Bilevel optimization problem:å¹¿ä¹‰ä¸Šæ¥è¯´ï¼ŒåŒå±‚è§„åˆ’å°±æ˜¯ä¸‹å±‚å‡½æ•°çš„è§£æ˜¯ä¸Šå±‚å‡½æ•°çš„è®¡ç®—å‚æ•°ï¼Œåœ¨è¿™é‡Œ
+ Lower level variable : W upper-level variable:Î¸

AutoEmbçš„åŸºäºDARTSçš„ä¼˜åŒ–æ–¹æ³•ï¼š

<img src="/../../../../../../../img/blog/2020-10-18-AutoEmb/image-20201113170418914.png" alt="image-20201113170418914" style="zoom:50%;" />

# Evaluation

è®ºæ–‡å®éªŒä¸­ä½¿ç”¨çš„æ•°æ®é›†ï¼š

<img src="/../../../../../../../img/blog/2020-10-18-AutoEmb/image-20201113170543919.png" alt="image-20201113170543919" style="zoom:50%;" />

å®éªŒç»“æœå¯¹æ¯”ï¼š

<img src="/../../../../../../../img/blog/2020-10-18-AutoEmb/image-20201113170610485.png" alt="image-20201113170610485" style="zoom:50%;" />

å…¶ä¸­ï¼ŒFSEè¡¨ç¤ºFixed-size Embeddingå›ºå®šEmbeddingç»´åº¦ï¼Œåœ¨å®éªŒä¸­Embeddingçš„ç»´åº¦æ˜¯æ‰€æœ‰ç»´åº¦æ±‚å’Œï¼›SAMè¡¨ç¤ºSuperivised Attention Modelï¼Œå’ŒAutoEmbç»“æ„ä¸€æ ·ï¼Œä½†æ˜¯å¯¹$W$å’Œ$Î¸$åŒæ—¶æ›´æ–°ï¼Œé€šè¿‡ç«¯åˆ°ç«¯æ–¹å¼ï¼›DARTSæ˜¯ä½¿ç”¨åŸå§‹DARTSåœ¨N=3çš„æ—¶å€™è®­ç»ƒå¾—åˆ°ä¸€ç»„å®å€¼ã€‚


# Notes

# References
1.[è®ºæ–‡é“¾æ¥][https://arxiv.org/abs/2002.11252]
		2.[å¯å¾®åˆ†æœç´¢ï¼ˆDARTSï¼‰][https://blog.csdn.net/u012347027/article/details/106175020]
		3.[DARTS å…¬å¼æ¨å¯¼ ][https://zhuanlan.zhihu.com/p/73037439]

